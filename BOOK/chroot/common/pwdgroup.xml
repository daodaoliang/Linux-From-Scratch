<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
  "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
]>

<sect1 id="ch-chroot-pwdgroup">
  <?dbhtml filename="pwdgroup.html"?>

  <title>Creating the passwd, group, and log Files</title>

  <indexterm zone="ch-chroot-pwdgroup">
    <primary sortas="e-${LFS}/etc/passwd">${LFS}/etc/passwd</primary>
  </indexterm>

  <indexterm zone="ch-chroot-pwdgroup">
    <primary sortas="e-${LFS}/etc/group">${LFS}/etc/group</primary>
  </indexterm>

  <indexterm zone="ch-chroot-pwdgroup">
    <primary sortas="e-${LFS}/var/run/utmp">${LFS}/var/run/utmp</primary>
  </indexterm>

  <indexterm zone="ch-chroot-pwdgroup">
    <primary sortas="e-${LFS}/var/log/btmp">${LFS}/var/log/btmp</primary>
  </indexterm>

  <indexterm zone="ch-chroot-pwdgroup">
    <primary sortas="e-${LFS}/var/log/lastlog">${LFS}/var/log/lastlog</primary>
  </indexterm>

  <indexterm zone="ch-chroot-pwdgroup">
    <primary sortas="e-${LFS}/var/log/wtmp">${LFS}/var/log/wtmp</primary>
  </indexterm>

  <para>In order for user <systemitem class="username">root</systemitem> to
  be able to login and for the name <quote>root</quote> to be recognized,
  there need to be relevant entries in the <filename>/etc/passwd</filename>
  and <filename>/etc/group</filename> files.</para>

  <para>Create the <filename>/etc/passwd</filename> file by running the
  following command:</para>

<screen><userinput>cat &gt; /etc/passwd &lt;&lt; "EOF"
<literal>root:x:0:0:root:/root:/bin/bash
nobody:x:65534:65534:Nobody:/:/sbin/nologin</literal>
EOF</userinput></screen>

  <xi:include xmlns:xi="http://www.w3.org/2003/XInclude"
  href="../../reboot/common/pwdgroup.xml"
  xpointer="xpointer(/sect1/para[3])"/>

  <para>Create the <filename>/etc/group</filename> file by running the
  following command:</para>

<screen><userinput>cat &gt; /etc/group &lt;&lt; "EOF"
<literal>root:x:0:
console:x:1:
tty:x:2:
kmem:x:3:
disk:x:4:
utmp:x:5:
nogroup:x:65534:</literal>
EOF</userinput></screen>

  <xi:include xmlns:xi="http://www.w3.org/2003/XInclude"
  href="../../reboot/common/pwdgroup.xml"
  xpointer="xpointer(/sect1/para[5])"/>

  <para>To remove the <quote>I have no name!</quote> prompt, start a
  new shell. Since a full Glibc was installed in <xref
  linkend="chapter-cross-tools"/> and the <filename>/etc/passwd</filename>
  and <filename>/etc/group</filename> files have been created, user name
  and group name resolution will now work.</para>

<screen><userinput>exec /tools/bin/bash --login +h</userinput></screen>

  <para>Note the use of the <parameter>+h</parameter> directive. This
  tells <command>bash</command> not to use its internal path hashing.
  Without this directive, <command>bash</command> would remember the
  paths to binaries it has executed. In order to use the newly compiled
  binaries as soon as they are installed, turn off this function for the
  duration of this chapter.</para>

  <xi:include xmlns:xi="http://www.w3.org/2003/XInclude"
  href="../../reboot/common/pwdgroup.xml"
  xpointer="xpointer(/sect1/para[6])"/>

<screen><userinput>touch /var/run/utmp /var/log/{btmp,lastlog,wtmp}
chgrp utmp /var/run/utmp /var/log/lastlog
chmod 664 /var/run/utmp /var/log/lastlog</userinput></screen>

  <para>The <filename>/var/run/utmp</filename> file records the users that
  are currently logged in. The <filename>/var/log/wtmp</filename> file records
  all logins and logouts. The <filename>/var/log/lastlog</filename> file
  records when each user last logged in. The <filename>/var/log/btmp</filename>
  file records the bad login attempts.</para>

</sect1>
