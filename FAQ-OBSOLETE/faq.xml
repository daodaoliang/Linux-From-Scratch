<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN">

<book id="index"><title>The LFS FAQ</title>
	<bookinfo>
		<author>
			<firstname>Seth</firstname>
			<othername>W.</othername>
			<surname>Klein</surname>
			<affiliation>
				<address>
					<email>sklein@mint.net</email>
				</address>
			</affiliation>
		</author>
	</bookinfo>
	<chapter><title>Introduction</title>
		<section><title>Why this FAQ?</title>
			<para>
				I started this FAQ in an attempt to make the traffic on
				lfs-discuss more manageable and improve the signal to noise
				ratio. I'm going to limit myself to things that come up
				often there leaving tips and such for
				<ulink url="http://www.linuxfromscratch.org/services/lfshints.php">LFS-Hints</ulink>.
			</para>
		</section>
		<section><title>What is appropriate for lfs-discuss?</title>
			<para>
				From the
				<ulink url="http://www.linuxfromscratch.org/services/mailinglistinfo.php">website</ulink>:
			</para>
			<blockquote>
				<para>
					The lfs-discuss mailinglist discusses matters strictly
					related to the LFS-BOOK. If you have problems with
					the book, want to report a bug or two or have suggestions
					to improve the book, use this mailinglist.
				</para>
				<para>
					Any other mail is to be posted to the lfs-apps list.
				</para>
			</blockquote>
			<para>
				For instance, GCC and Glibc are part of the book and
				belong on lfs-discuss.
				XFree86, KDE, and GNOME are not part of the book and
				belong on lfs-apps.
			</para>
		</section>
		<section><title>Contributing to this FAQ.</title>
			<para>
				If you have an addition or suggestion, please, let me know.
				I can be reached at
				<ulink url="mailto:sklein@mint.net">sklein@mint.net</ulink>,
				and i read lfs-discuss and lfs-apps thoroughly (but not always
				promptly).
			</para>
			<para>
				I'd like to list FAQ's for not only lfs-discuss, but lfs-apps
				as well. I want to stick to questions that have been asked
				at least twice and to remove items that are no longer an issue.
			</para>
		</section>
		<section><title>Where is the best place to get help?</title>
			<para>
				When this FAQ fails to help, there are several places to go.
			</para>
			<para>
				If you're having a problem with something in the book,
				it never hurts to go back over the book.
				It's surprising how easy it is to overlook little things.
			</para>
			<para>
				If nothing else,
				reading the appropriate man and info pages
				will yield useful information on some subject,
				if not what you were looking for,
				and insure that you know enough not to embarrass yourself
				if you have to ask someone.
			</para>
			<para>
				<ulink url="http://www.linuxdoc.org/">http://www.linuxdoc.org/</ulink>
				has the HOW-TOs and a great deal of other documentation.
				You might find something there.
			</para>
			<para>
				The linuxfromscratch.org site search includes the mailing lists.
				Many questions have been discussed there at least once.  It's at
				<ulink url="http://search.linuxfromscratch.org/">http://search.linuxfromscratch.org/</ulink>.
			</para>
			<para>
				For support type help, IRC is often best. It's faster,
				and doesn't clog the mailinglists.
				Information on the LFS IRC channel is at
				<ulink url="http://www.linuxfromscratch.org/services/irc.php">http://www.linuxfromscratch.org/services/irc.php</ulink>.
			</para>
			<para>
				As a last resort, there are the mailing lists.
				People will get frustrated with you if you use the wrong one or cross post.
				Mailing list information is at
				<ulink url="http://www.linuxfromscratch.org/services/mailinglistinfo.php">http://www.linuxfromscratch.org/services/mailinglistinfo.php</ulink>
				and tells which list to use.
			</para>
		</section>
		<section><title>What is LFS?</title>
			<para>
				LFS stands for Linux From Scratch which is a project that
				primarily documents how to install a Linux system by downloading,
				building, and installing the packages yourself.
			</para>
			<para>
				For why you might want to do this, how to do it, and other
				useful stuff, see the website at
				<ulink url="http://www.linuxfromscratch.org/">http://www.linuxfromscratch.org/</ulink>.
			</para>
		</section>
	</chapter>
	<chapter id="resources"><title>Resources</title>
		<section id="how-to-find"><title>How do I find package Foo?</title>	
			<para>Always try Freshmeat at <ulink
				url="http://freshmeat.net/">http://freshmeat.net/</ulink>
				before you ask on the list.
			</para>
		</section>
		<section id="what-dist"><title>What distribution should I use to start from?</title>
			<para>
				Any recent distribution should be fine. If you have problems,
				try installing and/or updating the development packages.
				(Look for ones starting in "gcc" or "glibc" "libstdc++" or
				ending in "-dev".)
			</para>
		</section>
	</chapter>
	<chapter id="compiling"><title>Compiling</title>
		<section id="before-ask-comp"><title>Before you ask on the list...</title>
			<section id="optimizations"><title>If you are using optimizations:</title>
				<para>
					If you're getting errors and you're using optimizations,
					try without optimizations. Even if the errors can't possibly
					be related. I've see reports of configure scripts not
					running because of optimization settings. Weird, huh?
				</para>
				<para>
					Also, optimization settings that work for someone else
					may not work for you. Settings that used to work may break
					if you make the smallest, most innocent hardware change.
				</para>
				<para>
					(If you don't know what optimization settings are,
					don't worry, you don't need to.)
				</para>
			</section>
			<section id="version-not-in-book"><title>If you are using a version not in the book:</title>
				<para>
					If you're getting errors and you're using a version of
					a package that differs from the version in the book
					(either newer or older), try the version in the book.
					Sometimes there are reasons why the book uses a particular
					version. Search the list archives if you're curious.
				</para>
			</section>
		</section>
		<section id="sig11"><title>I'm getting fatal errors about signal 11.</title>
			<para>
				See <ulink url="http://www.bitwizard.nl/sig11/">http://www.bitwizard.nl/sig11/</ulink>.
			</para>
		</section>
		<section id="gcc-warnings"><title>Are compiler warnings from GCC bad?</title>
			<para>
				Short answer: no.
			</para>
			<para>
				Long answer: probably, but only to someone
				working on the package you're trying to compile. Mostly,
				everything will be fine unless make quits with an error.
			</para>
			<para>
				Here's an example:
			</para>
			<screen>
sklein ~/tmp $ cat > Makefile
main:
	gcc main.c
sklein ~/tmp $ cat > main.c
void main() { exit(0); }
sklein ~/tmp $ make
gcc main.c
<emphasis role="bold">main.c: In function `main':
main.c:1: warning: return type of `main' is not `int'</emphasis>
sklein ~/tmp $ ######## that worked ########
sklein ~/tmp $ 
sklein ~/tmp $ cat > main.c
int main() { exxit(0) }
sklein ~/tmp $ make
gcc main.c
<emphasis role="bold">main.c: In function `main':
main.c:1: parse error before `}'
make: *** [main] Error 1</emphasis>
sklein ~/tmp $ ######## that failed ########
sklein ~/tmp $
			</screen>
		</section>
		<section id="perm-denied"><title>I'm getting `/dev/null: Permission denied'</title>
			<para>
				Does /dev/null look like this:
				<screen>
$ ls -l /dev/null
crw-rw-rw-   1 root     root       1,   3 Aug  3  2000 /dev/null
				</screen>
				If so, the problem is probably your mount options.
				You probably have a line in /etc/fstab like:
				<screen>
/dev/hda10	/mnt/lfs	ext2	user	1  2
				</screen>
				`user' is the mount flag, and it's the problem. To quote from
				the mount man page:
				<blockquote><screen> 
user  Allow  an  ordinary  user to mount the file system.
      This  option  implies  the options noexec,  nosuid,
      and nodev (unless overridden by subsequent options,
      as in the option line user,exec,dev,suid).
			</screen></blockquote>
				So change the line in /etc/fstab like this:
				<screen>
/dev/hda10	/mnt/lfs	ext2	defaults	1  2
				</screen>
			</para>
		</section>
		<section id="conf-guess-fail"><title>configure can't guess my host type.</title>
			<para>
				Typical symptoms look like this:
			</para>
			<screen>
sklein ~/tmp-0.0 $ ./configure 
creating cache ./config.cache
checking host system type... <emphasis role="bold">configure: error: can not guess host type; you must specify one</emphasis>
sklein ~/tmp-0.0 $
			</screen>
			<para>
				The problem is usually that the script can't run the compiler.
				Usually it's just a missing /usr/bin/cc symlink. You can fix it like
				this:
			</para>
			<screen>
cd /usr/bin
ln -s gcc cc
			</screen>
			<para>
				If that doesn't do it, check the file config.log created by configure.
				Errors go here and may indicate the problem.
			</para>
		</section>
		<section id="missing-x-includes"><title>A package can't find Xlib.h.</title>
			<para>
				Typical symptoms look like this:
			</para>
			<screen>
sklein ~/tmp $ cat > Makefile
x11:
        gcc x11.c
sklein ~/tmp $ cat > x11.c
#include &lt;X11/Xlib.h>
int main() { exit(0); }
sklein ~/tmp $ make
gcc x11.c
<emphasis role="bold">x11.c:1: X11/Xlib.h: No such file or directory
make: *** [x11] Error 1</emphasis>
sklein ~/tmp $ 
			</screen>
			<para>
				Creating a couple symlinks will fix this. Here are the commands:
			</para>
			<screen>
cd /usr
ln -s X11R6 X11
cd include
ln -s ../X11/include/X11 X11
			</screen>
		</section>
		<section id="stdgnu89"><title>I'm having trouble compiling something with GCC 3.x</title>
			<para>
				You should be aware that you're on the bleeding edge.
				As of 3.0, the LFS Book recommends GCC 2.95.3.
				However, there are some things you can do:
			</para>
			<para>
				Try adding the -std=gnu89 switch to the compile options.
				(For instance, in CFLAGS or CC.
				The exact method is a bit beyond the scope of this FAQ.)
			</para>
		</section>
	</chapter>
	<chapter id="specific-packages"><title>Questions about specific packages.</title>
		<section id="sh-utils-getloadavg"><title>My sh-utils build is failing with "undefined reference to `getloadavg'".</title>
			<para>
				If you're trying to build sh-utils and you're getting an error like this:
				<screen>
gcc  -g -O2  -static -o uptime  uptime.o ../lib/libsu.a -lutil
uptime.o: In function `print_uptime':
/lfs/tmp/sh-utils-2.0/src/uptime.c:125: undefined reference to `getloadavg'
collect2: ld returned 1 exit status
make[2]: *** [uptime] Error 1
make[2]: Leaving directory `/lfs/tmp/sh-utils-2.0/src'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/lfs/tmp/sh-utils-2.0'
make: *** [all-recursive-am] Error 2
				</screen>
				try the fix given in this post: <ulink
				url="http://archive.linuxfromscratch.org/mail-archives/lfsapps/2001/06/0497.html">http://archive.linuxfromscratch.org/mail-archives/lfsapps/2001/06/0497.html</ulink>
			</para>
		</section>
		<section id="optimized-glibc-fail"><title>My optimized build of glibc is failing in spinlock.c</title>
			<para>
				I should mention that glibc (and gcc and binutils)
				are good places to not optimize.
				The performance versus stability trade off is unusually poor
				for these packages. But. . . .
			</para>
			<para>
				If you've specified a CFLAGS value like `-march=i686 -mcpu=686'
				and you're getting an error like this:
				<screen>
spinlock.c: In function `__pthread_lock':
spinlock.c:107: inconsistent operand constraints in an `asm'
make[2]: *** [/usr/src/glibc-build/linuxthreads/spinlock.o] Error 1
make[2]: Leaving directory `/usr/src/glibc-2.2.4/linuxthreads'
make[1]: *** [linuxthreads/others] Error 2
make[1]: Leaving directory `/usr/src/glibc-2.2.4'
make: *** [all] Error 2
				</screen>
				It's because, unlike almost everything else,
				spinlock.c requires optimization.
				You have to set CFLAGS to something like
				`-march=i686 -mcpu=i686 -O2'.
				(Note the `-O2'.)
				Weird, huh?
				</para>
			</section>
		<section id="f-hostname"><title>My hostname is getting set to "-f"!</title>
			<para>
				You need to install the net-tools package. (See the instructions in
				the LFS book.)
			</para>
			<para>
				The hostname command your system is using is from sh-utils and doesn't
				support the -f option. When it is called with the -f option it assumes
				the hostname should be set to "-f". The hostname command from net-tools
				doesn't have this problem.
			</para>
		</section>
		<section id="kernel-modules"><title>How do I setup kernel modules?</title>
			<para>
				Follow the Module-HOWTO at <ulink
				url="http://www.linuxdoc.org/HOWTO/Module-HOWTO/">http://www.linuxdoc.org/HOWTO/Module-HOWTO/</ulink>.
			</para>
		</section>
<!--
		<section id="fileutils-error"><title>I'm getting errors when compiling fileutils.</title>
			<para>
				You may need to upgrade to the latest version or apply the fileutils patch.
				Both are available from <ulink
				url="http://download.linuxfromscratch.org/conglomeration/">http://download.linuxfromscratch.org/conglomeration/</ulink>.
			</para>
		</section>
-->
		<section id="glibc-crypt"><title>Where is glibc-crypt-2.2.x?</title>
			<para>
				As of glibc-2.2, you no longer need to get glibc-crypt separately.
				It has been merged into the main package because the US
				has relaxed it's export regulations.
			</para>
		</section>
		<section id="lilo-errors"><title>What do those LILO errors mean?</title>
			<para>
				The documentation in the LILO distribution lists all errors
				(such as when it prints "LI" and stops),
				but a quick overview is available at <ulink
				url="http://sdb.suse.de/sdb/en/html/kgw_lilo_errmsg.html">http://sdb.suse.de/sdb/en/html/kgw_lilo_errmsg.html</ulink>.
			</para>
		</section>
		<section id="net-pf-x"><title>I'm getting errors about net-pf-?.</title>
			<para>
				When you compiled net-tools you enabled support for a protocol
				family (that's where the "pf" comes from) that you didn't
				enable support for in the kernel. (You probably just accepted
				the default answers.)
 			</para>
			<para>
				A full list is in /usr/include/linux/socket.h but here is
				a list of the likely culprits:
				<simplelist>
					<member>
						net-pf-3: Amateur Radio AX.25 (AF_AX25)
					</member>
					<member>
						net-pf-4: Novell IPX (AF_IPX)
					</member>
					<member>
						net-pf-5: AppleTalk DDP (AF_APPLETALK)
					</member>
					<member>
						net-pf-6: Amateur Radio NET/ROM (AF_NETROM)
					</member>
					<member>
						net-pf-9: Reserved for X.25 project (AF_X25)
					</member>
				</simplelist>
			</para>
			<para>
				Naturally the fix is to recompile net-tools without support
				for the things you don't need. (Or recompile your kernel with
				support if you find you actually wanted them.) The workaround
				to put a line like the following in /etc/modules.conf
			</para>
			<screen>
alias net-pf-? off
			</screen>
			<para>
				Replace the question mark with the correct number, of course.
				And rerun depmod.
			</para>
			<para>
				If you get an error about net-pf-7, you probably need to
				enable support for the loopback network device (not block
				device) in your kernel. Or you may need to add the following
				line to /etc/modules.conf and rerun depmod.
			</para>
			<screen>
alias net-pf-7 loop
			</screen>
		</section>
		<section id="char-major-10-135"><title>I'm getting errors about char-major-10-135.</title>
			<para>
				Either delete /dev/rtc or enable RTC (Real Time Clock) support
				in your kernel.
			</para>
		</section>
	</chapter>
	<chapter id="additions"><title>Additions / Changes to LFS.</title>
		<para>
			LFS is a very basic system, in massive contrast to traditional
			distributions. The reason is this: LFS is not intended to create
			your system as you want it. It's intended to be just enough to
			allow you to build your system from it. It's not an end, it's
			a beginning. When you're done with LFS, you've just started
			building your system.
		</para>
		<para>
			This can be a problem if you're new to Unix systems and want
			a typical install with X and a web browser but have no idea
			what packages you need. For this reason, there is the After
			LFS Hint. It is one of the LFS Hints which can be found at <ulink
			url="http://www.linuxfromscratch.org/services/lfshints.php">http://www.linuxfromscratch.org/services/lfshints.php</ulink>.
		</para>
		<section id="new-version"><title>There's a new version of package Foo.</title>
			<para>
				There's no need to mention it unless you have something
				useful to add such as changes in the compile instructions.
				If it isn't already in CVS, it's on the todo list or
				we've chosen not to use it for some reason. A search of
				the list archives may reveal the reason.
			</para>
		</section>
		<section id="why-not-add"><title>Why not add / use package Foo?</title>
			<section id="add-grub"><title>GRUB instead of LILO</title>
				<para>
					GRUB has not yet been released as stable.
					When it is, it will be considered
					and, if it seems better than LILO, used.
				</para>
				<para>
					If your current setup is using GRUB,
					there's no need to switch to LILO.
					In addition to the GRUB documentation,
					there is an LFS Hint for GRUB.
					The LFS Hints are at <ulink
					url="http://www.linuxfromscratch.org/services/lfshints.php">http://www.linuxfromscratch.org/services/lfshints.php</ulink>.
				</para>
			</section>
			<section id="add-gawk"><title>gawk instead of mawk</title>
				<para>
					While gawk has improved recently,
					it is reported that mawk is still higher quality.
					It is smaller, faster, and works reliably.
				</para>
			</section>
			<section id="why-ed"><title>Why ed?</title>
				<para>
					There are several reasons why ed is in the book:
					<simplelist>
						<member>
							The official reason is that patch uses it to process ed
							scripts. However, these are seldom used recently;
							everyone uses diff.
						</member>
						<member>
							Unofficially, for all who've learned to use it,
							ed is a very useful emergency editor.
							The MS Windows standard telnet client can deal with ed
							where fullscreen editors (like vim) give it trouble.
							And a full featured vim requires not only ncurses, but
							X11 as well! Any trouble with those libraries will leave
							the system without an editor if ed isn't present.
						</member>
						<member>
							And, though it's not a reason to have ed in the book,
							some people actually like ed.
							It's also a major part of Unix history and understanding
							it helps with understanding vi(m).
						</member>
					</simplelist>
				</para>
			</section>
		</section>
		<section id="setup-polishing"><title>Polishing your setup.</title>
			<para>
				These don't really belong in the FAQ,
				but they come up often on the lists.
			</para>
			<section id="lesscharset"><title>Why does less (and therefore man)
				print &lt;AD&gt; instead of hyphens?</title>
				<para>
					Because the LESSCHARSET environment variable isn't set. To fix
					that, set it in /etc/profile by doing something like this:
				</para>
				<screen>
echo 'export LESSCHARSET=latin1' >> /etc/profile
				</screen>
			</section>
			<section id="which"><title>Where's which?</title>
				<para>
					It's not in there! A proper which is available
					from the GNU Project at
					<ulink url="ftp://ftp.gnu.org/gnu/which/">ftp://ftp.gnu.org/gnu/which/</ulink>
					or at
					<ulink url="http://www.xs4all.nl/~carlo17/which/">http://www.xs4all.nl/~carlo17/which/</ulink>.
					Or for systems that don't require a good user environment
					the simplest thing is probably to create a shell script
					using these commands:
				</para>
				<screen>
cat > /usr/bin/which << "EOF"
#!/bin/bash

type -p "$@"

EOF
chmod 755 /usr/bin/which
chown root.root /usr/bin/which
				</screen>
			</section>
			<section id="lex"><title>This ancient package wants lex?!?</title>
				<para>
					If you ever encounter a package so old that it must have
					lex instead of flex, you can create a script like the one
					for which (above) with these commands:
				</para>
				<screen>
cat > /usr/bin/lex << "EOF"
#!/bin/bash

exec /usr/bin/flex -l "$@"

EOF
chmod 755 /usr/bin/lex
chown root.root /usr/bin/lex
				</screen>
			</section>
		</section>
	</chapter>
</book>

