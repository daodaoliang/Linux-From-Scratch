<qandaentry id="xfree-png-lz">
<question><para>undefined reference to `deflate'</para></question>
<answer><para>If, when compiling XFree86, you get:
<screen>make[3]: Entering directory `/usr/src/xc/programs/xcursorgen'
rm -f xcursorgen
gcc -m32 -o xcursorgen -O2 -fno-strength-reduce -fno-strict-aliasing -ansi
-pedantic -Wall -Wpointer-arith -Wstrict-prototypes -Wmissing-prototypes
-Wmissing-declarations -Wredundant-decls -Wnested-externs -Wundef
-L../../exports/lib   xcursorgen.o -lXcursor -lXext -lX11 -lpng -lm
-Wl,-rpath-link,../../exports/lib
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.2/../../../libpng.so: undefined reference
to `deflate'
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.2/../../../libpng.so: undefined reference
to `inflate'
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.2/../../../libpng.so: undefined reference
to `inflateInit_'
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.2/../../../libpng.so: undefined reference
to `crc32'
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.2/../../../libpng.so: undefined reference
to `deflateInit2_'
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.2/../../../libpng.so: undefined reference
to `inflateReset'
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.2/../../../libpng.so: undefined reference
to `deflateReset'
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.2/../../../libpng.so: undefined reference
to `inflateEnd'
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.2/../../../libpng.so: undefined reference
to `deflateEnd'
collect2: ld returned 1 exit status
make[3]: *** [xcursorgen] Error 1
make[3]: Leaving directory `/usr/src/xc/programs/xcursorgen'
make[2]: *** [install] Error 2
make[2]: Leaving directory `/usr/src/xc/programs'
make[1]: *** [install] Error 2
make[1]: Leaving directory `/usr/src/xc'
make: *** [install] Error 2
</screen>
Then rebuild libpng with the patch at
<ulink url="http://www.linuxfromscratch.org/~sklein/libpng-1.2.5-lz.patch"/>.
Make sure you apply the patch immediately after unpacking the sources.
Like this:
<screen>tar --no-same-owner -xvjf libpng-1.2.5.tar.bz2
cd libpng-1.2.5
cat ../libpng-1.2.5-lz.patch | patch -p0
ln -s scripts/makefile.linux Makefile
make ZLIBLIB=/lib ZLIBINC=/usr/include
make ZLIBLIB=/lib ZLIBINC=/usr/include install
cd ..
rm -r libpng-1.2.5
</screen>
Needless to say, if you originally put zlib in /usr/local
or did something else different,
you'll have to adjust those instructions accordingly.
</para></answer>
</qandaentry>
