README for the newxml module
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Requirements
~~~~~~~~~~~~

DocBook XML DTD 4.3CR2 - this is required as the 4.2 version doesn't properly
                         support XIncludes

DocBook XSL Stylesheets 1.64.1 - older versions of the stylesheets had a bug
                                 which caused broken hyperlinks (they pointed to
                                 the wrong directory).

libxml2-2.6.4 & libxslt-1.1.2 - these releases have a couple of XInclude related
                                bugfixes in them


Setting up the DTD
~~~~~~~~~~~~~~~~~~

The new XML sources point to the canonical URL where the DTD can be found in
case it isn't installed locally.  In order to use our local copy we have to set
up 2 XML catalog files (/etc/xml/catalog and /etc/xml/docbook) so that the
canonical URLs are mapped to local files.

The easiest way to do this is to follow the BLFS instructions for the 4.2
version of the DTD.  Simply substitute 4.3CR2 in place of every occurence of 4.2
in the commands given.

Following this then run the commands listed under the "In order to install
ScrollKeeper" again, but replace every occurence of 4.1.2 with 4.2.  This will
allow any documents requiring the 4.2 version of the DTD to be processed
against the newer version of the DTD.

Additionally there's just two more commands to run:

  xmlcatalog --noout --add "delegateSystem" \
    "http://www.docbook.org/xml/" \
    "file:///etc/xml/docbook" /etc/xml/catalog &&
  xmlcatalog --noout --add "delegateURI" \
    "http://www.docbook.org/xml/" \
    "file:///etc/xml/docbook" /etc/xml/catalog

These are required as www.oasis-open.org only host official versions of the DTD,
www.docbook.org host the beta/work-in-progress versions.  The commands above
tell the XML processors that any requests to the www.docbook.org domain should
be routed through the local /etc/xml/docbook file (which subsequently rewrites
those URIs to our local copy of the DTD).  This step won't be required once the
official 4.3 release is made.


Processing the sources
~~~~~~~~~~~~~~~~~~~~~~

In order to process this version of the book simply use the following command:

xsltproc --nonet --xinclude -stringparam base.dir ~/lfs-book/ \
  stylesheets/lfs-chunked.xsl index.xml

This will produce chunked XHTML output in the directory specified by the base.dir command line parameter (~/lfs-book/ in the example above).

In time there will be other XSL files in the stylesheets directory to process the sources into formats such as LaTeX, Text, nALFS profiles.


TODO
~~~~

1. Further split the XML sources up
2. Reintroduce some entities that were removed during the cleanup
3. Provide a css file to provide nicer output than whatever the UA's default is.
   * Started - needs some comments regarding layout.
4. Decide whether we want to use the strict or traditional XHTML DTD.  Note in
   particular http://www.sagehill.net/docbookxsl/OtherOutputForms.html#d0e23340.
5. Move the legalinfo off the titlepage.
     * Started
     * It generates it's own hyperlink ("Legal Notice") but the current book has
       it linked to via the "Copyright" message above
     * It writes the legalnotice out to a randomly named file under ${base.dir}
       instead of the more preferable ${base.dir}/prologue/legalnotice.html.
6. Decide on what levels the TOCs should go down to.
   * Section elements now no longer have a TOC generated for them - the book TOC
     remains unchanged as do the part and appendix level TOCs.
7. Incorporate Alex's restructuring? 
