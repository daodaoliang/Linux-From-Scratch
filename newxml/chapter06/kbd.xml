<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.3CR3//EN" "http://www.docbook.org/xml/4.3CR3/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>
<sect1 xmlns:xi="http://www.w3.org/2003/XInclude" id="ch-system-kbd" xreflabel="Kbd">
<title>Installing Kbd-&kbd-version;</title>
<?dbhtml filename="kbd.html"?>

<para>The Kbd package contains keytable files and keyboard utilities.</para>

<screen>&buildtime; 0.1 SBU
&diskspace; 12 MB</screen>

<literallayout>Official download location for Kbd (&kbd-version;): 
<ulink url="ftp://ftp.win.tue.nl/pub/linux-local/utils/kbd/"/>
And for the patch:
<ulink url="&patches-root;kbd-&kbd-version;-more-programs-1.patch"/></literallayout>

<para>For its installation Kbd depends on: Bash, Binutils, Bison, Coreutils,
Diffutils, Flex, GCC, Gettext, Glibc, Grep, Gzip, M4, Make, Sed.</para>



<sect2>
<title>Installation of Kbd</title>

<para>By default some of Kbd's utilities (<command>setlogcons</command>,
<command>setvesablank</command> and <command>getunimap</command>) are
not installed. First enable the compilation of these utilities:</para>

<screen><userinput>patch -Np1 -i ../kbd-&kbd-version;-more-programs-1.patch</userinput></screen>

<para>Now prepare Kbd for compilation:</para>

<screen><userinput>./configure</userinput></screen>

<para>Compile the package:</para>

<screen><userinput>make</userinput></screen>

<para>And install it:</para>

<screen><userinput>make install</userinput></screen>

</sect2>

<sect2><title>Configuring your keyboard</title>

<para>Few things are more annoying than using Linux while a wrong keymap
for your keyboard is loaded. If you have a standard US keyboard, however, you
can skip this section, as the US keymap is the default as long as you don't
change it.</para>

<para>To change the default keymap, create the
<filename class="symlink">/usr/share/kbd/keymaps/defkeymap.map.gz</filename>
symlink by running the following command:</para>

<screen><userinput>ln -s path/to/keymap /usr/share/kbd/keymaps/defkeymap.map.gz</userinput></screen>

<para>Of course, replace <filename>path/to/keymap</filename> with the path and
name of your keyboard's map file. For example, if you have a Dutch keyboard,
you would use <filename>i386/qwerty/nl.map.gz</filename>.</para>

<para>Another way to set your keyboard's layout is to compile the keymap
into the kernel. This ensures that your keyboard will always work as expected,
even when you boot into maintenance mode (by passing `init=/bin/sh' to the
kernel), as then the bootscript that normally sets up your keymap isn't run.</para>

<para>When in <xref linkend="chapter-bootable"/> you're ready to compile the
kernel, run the following command to patch the current default keymap into the
source (you will have to repeat this command whenever you unpack a new
kernel):</para>

<screen><userinput>loadkeys -m /usr/share/kbd/keymaps/defkeymap.map.gz &gt; \
    /usr/src/linux-2.4.25/drivers/char/defkeymap.c</userinput></screen>

</sect2>


<sect2 id="contents-kbd"><title>Contents of Kbd</title>

<para><emphasis>Installed programs</emphasis>: chvt, deallocvt, dumpkeys,
fgconsole, getkeycodes, getunimap, kbd_mode, kbdrate, loadkeys, loadunimap,
mapscrn, openvt, psfaddtable (link to psfxtable), psfgettable (link to
psfxtable), psfstriptable (link to psfxtable), psfxtable, resizecons,
setfont, setkeycodes, setleds, setlogcons, setmetamode, setvesablank,
showconsolefont, showkey, unicode_start and unicode_stop</para>

</sect2>


<sect2><title>Short descriptions</title>

<para><command>chvt</command> changes the foreground virtual terminal.</para>

<para><command>deallocvt</command> deallocates unused virtual terminals.</para>

<para><command>dumpkeys</command> dumps the keyboard translation tables.</para>

<para><command>fgconsole</command> prints the number of the active virtual terminal.</para>

<para><command>getkeycodes</command> prints the kernel scancode-to-keycode
mapping table.</para>

<para><command>getunimap</command> prints the currently used unimap.</para>

<para><command>kbd_mode</command> reports or sets the keyboard mode.</para>

<para><command>kbdrate</command> sets the keyboard repeat and delay rates.</para>

<para><command>loadkeys</command> loads the keyboard translation tables.</para>

<para><command>loadunimap</command> loads the kernel unicode-to-font mapping table.</para>

<para><command>mapscrn</command> is an obsolete program that used to load
a user-defined output character mapping table into the console driver. This is
now done by setfont.</para>

<para><command>openvt</command> starts a program on a new virtual terminal (VT).</para>

<para><command>psf*</command> are a set of tools for handling Unicode
character tables for console fonts.</para>

<para><command>resizecons</command> changes the kernel idea of the console size.</para>

<para><command>setfont</command> lets you change the EGA/VGA fonts on the console.</para>

<para><command>setkeycodes</command> loads kernel scancode-to-keycode
mapping table entries, useful if you have some unusual keys on your keyboard.</para>

<para><command>setleds</command> sets the keyboard flags and LEDs. Many
people find it useful to have NumLock on by default, setleds +num achieves this.</para>

<para><command>setlogcons</command> sends kernel messages to the console.</para>

<para><command>setmetamode</command> defines the keyboard meta key handling.</para>

<para><command>setvesablank</command> lets you fiddle with the built-in
hardware screensaver (no toasters, just a blank screen).</para>

<para><command>showconsolefont</command> shows the current EGA/VGA console
screen font.</para>

<para><command>showkey</command> reports the scancodes and keycodes and
ASCII codes of the keys pressed on the keyboard.</para>

<para><command>unicode_start</command> puts the keyboard and console in
unicode mode.</para>

<para><command>unicode_stop</command> reverts keyboard and console from
unicode mode.</para>

</sect2>



</sect1>
