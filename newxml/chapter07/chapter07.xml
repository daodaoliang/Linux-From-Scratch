<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.3CR2//EN" "http://www.oasis-open.org/docbook/xml/4.3b2/docbookx.dtd">
<chapter id="chapter07" xreflabel="Chapter 7">
<?dbhtml dir="chapter07"?>
<title>Setting up system boot scripts</title>
<?dbhtml filename="chapter07.html"?>

<sect1 id="ch07-introduction">
<title>Introduction</title>
<?dbhtml filename="introduction.html"?>

<para>This chapter will set up the bootscripts that you installed in chapter
6. Most of these scripts will work without needing to modify them, but a
few do require additional configuration files set up as they deal with
hardware dependent information.</para>

</sect1>


<sect1 id="ch07-usage">
<title>How does the booting process with these scripts work?</title>
<?dbhtml filename="usage.html"?>

<para>Linux uses a special booting facility named SysVinit. It's based on a
concept of <emphasis>runlevels</emphasis>. It can be widely different 
from one system to another, so it can't be assumed that because things 
worked in &lt;insert distro name&gt; they should work like that in LFS 
too. LFS has its own way of doing things, but it respects generally 
accepted standards.</para>

<para>SysVinit (which we'll call <emphasis>init</emphasis> from now on) works 
using a runlevels scheme. There are 7 (from 0 to 6) runlevels
(actually, there are more runlevels but they are for special cases and 
generally not used. The init man page describes those details), and each 
one of those corresponds to the things the computer is supposed to do when 
it starts up. The default runlevel is 3. Here are the descriptions of the 
different runlevels as they are often implemented:</para>

<literallayout>0: halt the computer
1: single-user mode
2: multi-user mode without networking
3: multi-user mode with networking
4: reserved for customization, otherwise does the same as 3
5: same as 4, it is usually used for GUI login (like X's xdm or KDE's kdm)
6: reboot the computer</literallayout>

<para>The command used to change runlevels is <userinput>init
&lt;runlevel&gt;</userinput> where &lt;runlevel&gt; is 
the target runlevel. For example, to reboot the computer, a user would issue
the init 6 command. The reboot command is just an alias, as is the halt
command an alias to init 0.</para>

<para>There are a number of directories under /etc/rc.d that look like
like rc?.d where ? is the number of the runlevel and rcsysinit.d which
contain a number of symbolic links. Some begin with a K, the others
begin with an S, and all of them have two numbers following the initial
letter. The K means to stop (kill) a service, and the S means to start a
service. The numbers determine the order in which the scripts are run,
from 00 to 99; the lower the number the sooner it gets executed. When init
switches to another runlevel, the appropriate services get killed and
others get started.</para>

<para>The real scripts are in /etc/rc.d/init.d. They do all the work, and the
symlinks all point to them. Killing links and starting links point to 
the same script in /etc/rc.d/init.d. That's because the scripts can be 
called with different parameters like start, stop, restart, reload, 
status. When a K link is encountered, the appropriate script is run with 
the stop argument. When a S link is encountered, the appropriate script 
is run with the start argument.</para>

<para>There is one exception. Links that start with an S in the
rc0.d and rc6.d directories will not cause anything to be started. They
will be called with the parameter <emphasis>stop</emphasis> to stop
something. The logic behind it is that when you are going to reboot or
halt the system, you don't want to start anything, only stop the
system.</para>

<para>These are descriptions of what the arguments make the 
scripts do:</para>

<itemizedlist>

<listitem><para><emphasis>start</emphasis>: The service is 
started.</para></listitem>

<listitem><para><emphasis>stop</emphasis>: The service is 
stopped.</para></listitem>

<listitem><para><emphasis>restart</emphasis>: The service is 
stopped and then started again.</para></listitem>

<listitem><para><emphasis>reload</emphasis>: The configuration 
of the service is updated. 
This is used after the configuration file of a service was modified, when 
the service doesn't need to be restarted.</para></listitem>

<listitem><para><emphasis>status</emphasis>: Tells if the service 
is running and with which PIDs.</para></listitem>

</itemizedlist>

<para>Feel free to modify the way the boot process works (after all, it's your 
own LFS system). The files given here are just an example of how it can be 
done in a nice way (well, what we consider nice -- you may hate it).</para>

</sect1>


<sect1 id="ch07-setclock">
<title>Configuring the setclock script</title>
<?dbhtml filename="setclock.html"?>

<para>This setclock script reads the time from your hardware clock (also
known as BIOS or CMOS clock) and either converts that time to localtime
using the <filename>/etc/localtime</filename> file (if the hardware clock
is set to GMT) or not (if the hardware clock is already set to localtime).
There is no way to auto-detect whether the hardware clock is set to GMT or
not, so we need to configure that here ourselves.</para>

<para>Change the value of the <emphasis>UTC</emphasis> variable below to a
<emphasis>0</emphasis> (zero) if your hardware clock is not set to GMT
time.</para>

<para>Create a new file <filename>/etc/sysconfig/clock</filename> by running
the following:</para>

<screen><userinput>cat &gt; /etc/sysconfig/clock &lt;&lt; "EOF"</userinput>
# Begin /etc/sysconfig/clock

UTC=1

# End /etc/sysconfig/clock
<userinput>EOF</userinput></screen>

<para>Now, you may want to take a look at a very good hint explaining how we
deal with time on LFS at <ulink url="http://www.linuxfromscratch.org/hints/downloads/files/time.txt"/>. 
It explains issues such as time zones, UTC, and the TZ environment
variable.</para>

</sect1>


<sect1 id="ch07-loadkeys">
<title>Do I need the loadkeys script?</title>
<?dbhtml filename="loadkeys.html"?>

<para>If you decided to compile your keymap file directly into the kernel back
at the end of <xref linkend="chapter06"/>, then you strictly speaking don't
need to run this loadkeys script, since the kernel has already set up the
keymap for you. You can still run it if you want, it isn't going to hurt you.
It could even be beneficial to keep it in case you run a lot of different
kernels and don't remember or want to compile the keymap into every kernel you
lay your hands on.</para>

<para>If you decided you don't need to, or don't want to use the loadkeys
script, remove the
<filename class="symlink">/etc/rc.d/rcsysinit.d/S70loadkeys</filename>
symlink.</para>

</sect1>


<sect1 id="ch07-sysklogd">
<title>Configuring the sysklogd script</title>
<?dbhtml filename="sysklogd.html"?>

<para>The <filename>sysklogd</filename> script invokes the
<userinput>syslogd</userinput> program with the <emphasis>-m 0</emphasis>
option. This option turns off the periodic timestamp mark that syslogd
writes to the log files every 20 minutes by default. If you want to turn
on this periodic timestamp mark, edit the <filename>sysklogd</filename>
script and make the changes accordingly. See <userinput>man
syslogd</userinput> for more information.</para>

</sect1>


<sect1 id="ch07-hostname">
<title>Configuring the localnet script</title>
<?dbhtml filename="hostname.html"?>

<para>Part of the localnet script is setting up the system's hostname. This
needs to be configured in the /etc/sysconfig/network.</para>

<para>Create the /etc/sysconfig/network file and enter a hostname by
running:</para>

<screen><userinput>echo "HOSTNAME=lfs" &gt; /etc/sysconfig/network</userinput></screen>

<para><quote>lfs</quote> needs to be replaced with the name the computer is 
to be called. You should not enter the FQDN (Fully Qualified Domain
Name) here. That information will be put in the
<filename>/etc/hosts</filename> file later on.</para>

</sect1>


<sect1 id="ch07-hosts">
<title>Creating the /etc/hosts file</title>
<?dbhtml filename="hosts.html"?>

<para>If a network card is to be configured, you have to decide on the
IP-address, FQDN and possible aliases for use in the /etc/hosts file. The
syntax is:</para>

<screen>&lt;IP address&gt; myhost.mydomain.org aliases</screen>

<para>You should make sure that the IP-address is in the private network
IP-address range. Valid ranges are:</para>

<screen>	Class Networks
	A     10.0.0.0
	B     172.16.0.0 through 172.31.0.0
	C     192.168.0.0 through 192.168.255.0</screen>

<para>A valid IP address could be 192.168.1.1. A valid FQDN for this IP could
be www.linuxfromscratch.org.</para>

<para>If you aren't going to use a network card, you still need to 
come up with a FQDN. This is necessary for certain programs to operate
correctly.</para>

<para>If a network card is not going to be configured, create the
<filename>/etc/hosts</filename> file by running:</para>

<screen><userinput>cat &gt; /etc/hosts &lt;&lt; "EOF"</userinput>
# Begin /etc/hosts (no network card version)

127.0.0.1 &lt;value of HOSTNAME&gt;.mydomain.com &lt;value of HOSTNAME&gt; localhost

# End /etc/hosts (no network card version)
<userinput>EOF</userinput></screen>

<para>If a network card is to be configured, create the 
<filename>/etc/hosts</filename> file by running:</para>

<screen><userinput>cat &gt; /etc/hosts &lt;&lt; "EOF"</userinput>
# Begin /etc/hosts (network card version)

127.0.0.1 localhost.localdomain localhost
192.168.1.1 &lt;value of HOSTNAME&gt;.mydomain.org &lt;value of HOSTNAME&gt;

# End /etc/hosts (network card version)
<userinput>EOF</userinput></screen>

<para>Of course, the 192.168.1.1 and &lt;value of HOSTNAME&gt;.mydomain.org
have to be changed to your liking (or requirements if assigned an IP-address
by a network/system administrator and this machine is planned to be connected
to an existing network).</para>

</sect1>


<sect1 id="ch07-network">
<title>Configuring the network script</title>
<?dbhtml filename="network.html"?>

<para>This section only applies if you're going to configure a network
card.</para>

<para>If you don't have any network cards, you are most likely not going to
create any configuration files relating to network cards. If that is the
case, you must remove the <filename>network</filename> symlinks from all the
runlevel directories
(<filename class="directory">/etc/rc.d/rc*.d</filename>)</para>

<sect2>
<title>Configuring default gateway</title>

<para>If you're on a network you may need to set up the default gateway for
this machine. This is done by adding the proper values to the
/etc/sysconfig/network file by running the following:</para>

<screen><userinput>cat &gt;&gt; /etc/sysconfig/network &lt;&lt; "EOF"</userinput>
GATEWAY=192.168.1.2
GATEWAY_IF=eth0
<userinput>EOF</userinput></screen>

<para>The values for GATEWAY and GATEWAY_IF need to be changed to match
your network setup. GATEWAY contains the IP address of the default
gateway, and GATEWAY_IF contains the network interface through which the
default gateway can be reached.</para>

</sect2>

<sect2>
<title>Creating network interface configuration files</title>

<para>Which interfaces are brought up and down by the network script depends on
the files in the /etc/sysconfig/network-devices directory. This
directory should contain files in the form of ifconfig.xyz, where xyz is a
network interface name (such as eth0 or eth0:1)</para>

<para>If you decide to rename or move this /etc/sysconfig/network-devices
directory, make sure you update the /etc/sysconfig/rc file as well and
update the network_devices by providing it with the new path.</para>

<para>Now, new files are created in that directory containing the following.
The following command creates a sample ifconfig.eth0 file:</para>

<screen><userinput>cat &gt; /etc/sysconfig/network-devices/ifconfig.eth0 &lt;&lt; "EOF"</userinput>
ONBOOT=yes
IP=192.168.1.1
NETMASK=255.255.255.0
BROADCAST=192.168.1.255
<userinput>EOF</userinput></screen>

<para>Of course, the values of those variables have to be changed 
in every file to match the proper setup. If the ONBOOT variable is set
to yes, the network script will bring it up during the booting of the system.
If set to anything else but yes, it will be ignored by the network script
and thus not brought up.</para>

</sect2>

</sect1>



</chapter>
